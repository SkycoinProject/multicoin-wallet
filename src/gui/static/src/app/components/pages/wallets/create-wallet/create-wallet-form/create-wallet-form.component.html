<!-- Shown if the currently selected coin is not compatible with software wallets. -->
<div class="main-container" [formGroup]="form" *ngIf="!softwareWalletsAllowedForCoin">
  <!-- Coin selection. -->
  <div class="form-field" *ngIf="hasManyCoins && onboarding">
    <label for="coin">{{ 'wallet.new.coin-label' | translate }}</label>
    <div class="-select" [ngClass]="{'element-disabled' : busy}">
      <app-select-coin id="coin"></app-select-coin>
    </div>
  </div>
  <!-- Warnings telling the user about the compatibility limitations of the currently selected coin. -->
  <div class="form-field centered" [ngClass]="{'red-text': !onboarding, 'white-text transparent-text': onboarding}" *ngIf="!hardwareWalletsAllowedForCoin">
    {{ 'wallet.new.not-available-warning' | translate }}
  </div>
  <div class="form-field centered" [ngClass]="{'red-text': !onboarding, 'white-text transparent-text': onboarding}" *ngIf="hardwareWalletsAllowedForCoin">
    {{ 'wallet.new.skywallet-only-warning' | translate }}
  </div>
</div>

<!-- Normal form. -->
<div class="main-container" [formGroup]="form" *ngIf="softwareWalletsAllowedForCoin">
  <!-- Wallet label. -->
  <div class="form-field">
    <label for="label">{{ 'wallet.new.name-label' | translate }}</label>
    <input formControlName="label" id="label" [attr.disabled]="busy ? 'true' : null" [appFormFieldError]="labelErrorMsg" (blur)="validateForm()">
  </div>
  <!-- Coin selection. -->
  <div class="form-field" *ngIf="hasManyCoins && onboarding">
    <label for="coin">{{ 'wallet.new.coin-label' | translate }}</label>
    <div class="-select" [ngClass]="{'element-disabled' : busy}">
      <app-select-coin id="coin"></app-select-coin>
    </div>
  </div>
  <!-- How many words the seed has (while loading only). -->
  <div class="form-field" *ngIf="!create && !activateXPubField && enterSeedWithAssistance">
    <label for="number_of_words">{{ 'wallet.new.words-number-label' | translate}}</label>
    <div class="-select">
      <select formControlName="number_of_words" id="number_of_words" [attr.disabled]="busy ? 'true' : null">
        <option [ngValue]="12">{{ 'wallet.new.12-words' | translate }}</option>
        <option [ngValue]="24">{{ 'wallet.new.24-words' | translate }}</option>
      </select>
    </div>
  </div>
  <div class="form-field" *ngIf="!activateXPubField">
    <!-- Seed label and the buttons for creating another seed. -->
    <label for="seed">
      <span>{{ 'wallet.new.seed-label' | translate }}</span>
      <ng-container *ngIf="onboarding">
        <span class="generators -white-text" [ngClass]="{'element-disabled' : busy}" *ngIf="create">
          <span class="link" (click)="generateSeed(128)" [matTooltip]="'wallet.new.generate-12-help' | translate">
            {{ 'wallet.new.12-words' | translate }}
          </span>
          <span class="divider">|</span>
          <span class="link" (click)="generateSeed(256)" [matTooltip]="'wallet.new.generate-24-help' | translate">
            {{ 'wallet.new.24-words' | translate }}
          </span>
        </span>
      </ng-container>
      <ng-container *ngIf="!onboarding">
        <span class="generators" [ngClass]="{'element-disabled' : busy}" *ngIf="create">
          <span class="link" appThemeColorText (click)="generateSeed(128)" [matTooltip]="'wallet.new.generate-12-help' | translate">
            {{ 'wallet.new.12-words' | translate }}
          </span>
          <span class="divider">|</span>
          <span class="link" appThemeColorText (click)="generateSeed(256)" [matTooltip]="'wallet.new.generate-24-help' | translate">
            {{ 'wallet.new.24-words' | translate }}
          </span>
        </span>
      </ng-container>
    </label>

    <!-- First seed field for the assisted mode. -->
    <div [ngClass]="{'d-none': !enterSeedWithAssistance}">
      <div *ngIf="create" class="dashed-border non-editable-field" [ngClass]="{'onboarding-version': onboarding, 'element-disabled' : busy}">
        <span class="normal-seed-field">{{ lastAutogeneratedSeed }}</span>
      </div>
      <app-assisted-seed-field
        *ngIf="!create"
        #assistedSeed
        [showConfirmationOnly]="false"
        [onboarding]="onboarding"
        [busy]="busy"
        [emptyText]="'wallet.new.seed.enter-seed'"
        [howManyWords]="form && form.value.number_of_words ? form.value.number_of_words : 0"
        [reasonForAsking]="wordAskedReasons.RecoveringSoftwareWallet">
      </app-assisted-seed-field>
      <div *ngIf="!onboarding" appThemeColorText [ngClass]="{'element-disabled' : busy}" class="seed-type-button">
        <span appThemeColorText class="link" (click)="changeSeedType()">
          <mat-icon [inline]="true">edit</mat-icon>
          {{ 'wallet.new.seed.use-custom' | translate }}
        </span>
      </div>
      <div *ngIf="onboarding" [ngClass]="{'element-disabled' : busy}" class="seed-type-button">
        <span class="link -white-text" (click)="changeSeedType()">
          <mat-icon [inline]="true">edit</mat-icon>
          {{ 'wallet.new.seed.use-custom' | translate }}
        </span>
      </div>
    </div>

    <!-- First seed field for the manual mode. -->
    <ng-container *ngIf="!enterSeedWithAssistance">
      <div class="seed-spinner" *ngIf="checkingCustomSeed"><mat-spinner appMainColorFormElement></mat-spinner></div>
      <textarea
        formControlName="seed"
        id="seed"
        rows="2"
        [attr.disabled]="busy ? 'true' : null"
        [appFormFieldError]="seed1ErrorMsg"
        (blur)="validateForm()"
      ></textarea>
      <div *ngIf="!onboarding" [ngClass]="{'element-disabled' : busy}" class="seed-type-button">
        <span appThemeColorText class="link" (click)="changeSeedType()">
          <mat-icon [inline]="true">format_list_numbered</mat-icon>
          {{ 'wallet.new.seed.use-normal' | translate }}
        </span>
      </div>
      <div *ngIf="onboarding" [ngClass]="{'element-disabled' : busy}" class="seed-type-button">
        <span class="link -white-text" (click)="changeSeedType()">
          <mat-icon [inline]="true">format_list_numbered</mat-icon>
          {{ 'wallet.new.seed.use-normal' | translate }}
        </span>
      </div>
    </ng-container>

    <p class="disclaimer-box" [ngClass]="{'red-text': !onboarding, 'white-text transparent-text': onboarding}" *ngIf="create">
      {{ 'wallet.new.seed-warning' | translate}}
    </p>
  </div>
  <div class="form-field" *ngIf="create && !activateXPubField">
    <label for="confirm_seed">{{ 'wallet.new.confirm-seed-label' | translate}}</label>
    <!-- Second seed field for the assisted mode. -->
    <div [ngClass]="{'d-none': !enterSeedWithAssistance}">
      <app-assisted-seed-field
        #assistedSeed
        [showConfirmationOnly]="true"
        [seedToConfirm]="lastAutogeneratedSeed"
        [onboarding]="onboarding"
        [busy]="busy"
        [emptyText]="'wallet.new.seed.confirm-seed'"
        [confirmedText]="'wallet.new.seed.confirmed-seed'"
        [howManyWords]="numberOfAutogeneratedWords"
        [reasonForAsking]="wordAskedReasons.CreatingSoftwareWallet">
      </app-assisted-seed-field>
    </div>

    <!-- Second seed field for the manual mode. -->
    <ng-container *ngIf="!enterSeedWithAssistance">
      <div class="seed-spinner" *ngIf="checkingCustomSeed"><mat-spinner appMainColorFormElement></mat-spinner></div>
      <textarea
        formControlName="confirm_seed"
        id="confirm_seed"
        rows="2"
        [attr.disabled]="busy ? 'true' : null"
        [appFormFieldError]="seed2ErrorMsg"
        (blur)="validateForm()"
      ></textarea>
    </ng-container>
  </div>
  <!-- xPub key. -->
  <div class="form-field" *ngIf="activateXPubField">
    <label for="xpub">{{ 'wallet.new.xpub-label' | translate}}</label>
    <ng-container>
      <textarea
        formControlName="xpub"
        id="xpub"
        rows="2"
        [attr.disabled]="busy ? 'true' : null"
        [appFormFieldError]="xPubErrorMsg"
        (blur)="validateForm()"
      ></textarea>
    </ng-container>
  </div>
  <!-- Advanced options link. -->
  <div class="form-field">
    <app-arrow-link
      text="wallet.new.advanced-options-link"
      (pressed)="toggleAdvancedOptions()"
      [pointDown]="!showAdvancedOptions"
      [noPadding]="true"
      [whiteText]="onboarding"
      [ngClass]="{'element-disabled' : busy}"
      *ngIf="showWalletTypeOptions">
    </app-arrow-link>
  </div>
  <div *ngIf="showAdvancedOptions">
    <!-- Wallet type. -->
    <div class="form-field">
      <label for="type">
        {{ 'wallet.new.type-label' | translate}}
        <mat-icon class="help-icon" [ngClass]="{'-white-text': onboarding}" [matTooltip]="'wallet.new.type-info' | translate">help</mat-icon>
      </label>
      <div class="-select">
        <select formControlName="type" id="type" [attr.disabled]="busy ? 'true' : null">
          <option *ngIf="legacyAllowedForCoin" [ngValue]="walletTypes.Deterministic">{{ 'wallet.new.type-deterministic' | translate }}</option>
          <option *ngIf="bip44Enabled && bip44AllowedForCoin" [ngValue]="walletTypes.Bip44">{{ 'wallet.new.type-bip44' | translate }}</option>
          <option *ngIf="xPubEnabled && xPubAllowedForCoin" [ngValue]="walletTypes.XPub">{{ 'wallet.new.type-xpub' | translate }}</option>
        </select>
      </div>
    </div>
    <!-- Passphrase. -->
    <div class="form-field" *ngIf="activatePassphraseField">
      <label for="passphrase">
        {{ 'wallet.new.passphrase-label' | translate}}
        <mat-icon class="help-icon" [ngClass]="{'-white-text': onboarding}" [matTooltip]="'wallet.new.passphrase-info' | translate">help</mat-icon>
      </label>
      <input formControlName="passphrase" id="passphrase" [attr.disabled]="busy ? 'true' : null" (keydown.enter)="!encrypt ? requestCreation() : null">
    </div>
    <!-- Alert for the passphrase. -->
    <div class="alert-box" *ngIf="showPassphraseWarning && activatePassphraseField">
      <mat-icon>error</mat-icon>
      <div>
        <div class="title">{{ 'wallet.new.passphrase-warning-title' | translate}}</div>
        <div>{{ 'wallet.new.passphrase-warning' | translate}}</div>
        <mat-checkbox #seedCheck
          type="checkbox" class="-check" appMainColorFormElement
          [checked]="passphraseWarningAccepted" (change)="onPassphraseWarningAcceptance($event)" [ngClass]="{'element-disabled' : busy}"
        >
          {{ 'common.generic-confirmation-check' | translate}}
        </mat-checkbox>
      </div>
    </div>
  </div>
  <!-- Password area. -->
  <div *ngIf="!onboarding">
    <div>
      <!-- Password usage selector. -->
      <mat-checkbox class="-check" appMainColorFormElement (change)="setEncrypt($event)" type="checkbox" id="encrypt" [checked]="true" [ngClass]="{'element-disabled' : busy}">
        <span class="img-label-container"><img [appImageColor]="true" src="assets/img/lock-configurable.png"> {{ 'wallet.new.encrypt-check' | translate }}</span>
      </mat-checkbox>
    </div>
    <div class="row -passwords">
      <div class="col-md-12">
        <p class="-info">
          <span>
            {{ ('wallet.new.encrypt-warning' + (!activateXPubField ? '-non' : '') + '-xpub') | translate }}
          </span>
        </p>
      </div>
      <!-- Password fields. -->
      <div class="col-md-6" *ngIf="encrypt">
        <div class="form-field">
          <label for="password">{{ 'password.password-label' | translate }}</label>
          <input
            formControlName="password"
            id="password"
            type="password"
            appDontSavePassword
            [attr.disabled]="busy ? 'true' : null"
            [appFormFieldError]="password1ErrorMsg"
            (blur)="validateForm()"
          >
        </div>
      </div>
      <div class="col-md-6" *ngIf="encrypt">
        <div class="form-field">
          <label for="confirm_password">{{ 'password.confirm-password-label' | translate }}</label>
          <input
            formControlName="confirm_password"
            id="confirm_password"
            type="password"
            appDontSavePassword
            (keydown.enter)="requestCreation()"
            [attr.disabled]="busy ? 'true' : null"
            [appFormFieldError]="password2ErrorMsg"
            (blur)="validateForm()"
          >
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Alert for non-standard manually entered seeds. -->
<div class="alert-box" *ngIf="form.valid && !customSeedIsNormal && !activateXPubField">
  <mat-icon>error</mat-icon>
  <div>
    <div class="title">{{ 'wallet.new.unconventional-seed-title' | translate}}</div>
    <div>{{ 'wallet.new.unconventional-seed-text' | translate}}</div>
    <mat-checkbox #seedCheck
      type="checkbox" class="-check" appMainColorFormElement
      [checked]="customSeedAccepted" (change)="onCustomSeedAcceptance($event)" [ngClass]="{'element-disabled' : busy}"
    >
      {{ 'wallet.new.unconventional-seed-check' | translate}}
    </mat-checkbox>
  </div>
</div>
